#include "game/commands/PlayerCommand.hpp"
#include "game/backend/Self.hpp"
#include "game/pointers/Pointers.hpp"

namespace YimMenu::Features
{
	class KillLoopExploit : public PlayerCommand
	{
		using PlayerCommand::PlayerCommand;

		virtual void OnCall(Player player) override
		{
			if (auto ped = player.GetPed(); ped && Self::GetPed())
			{
				auto pos = ped.GetPosition();
				auto self = Self::GetPed().GetPointer<CEntity*>();
				Pointers.TriggerWeaponDamageEvent(self, ped.GetPointer<CEntity*>(), &pos, 0, true, "WEAPON_TRANQUILIZER"_J, 9999.0f, 0, 0, (1 << 0) | (1 << 4) | (1 << 12) | (1 << 19), 0, 0, 0, false, false, false, false, nullptr);
			}
		}
	};

	static KillLoopExploit _KillLoopExploit{"killexploit", "Permadeath", "Forces player into permadeath that can only be fixed by a game restart"};
}